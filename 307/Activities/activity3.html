<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity 3: Matrix Operations</title>
    <link rel="stylesheet" href="styles.css">
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        .op-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 800px) {
            .op-grid {
                grid-template-columns: 1fr;
            }
        }

        .tab-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        svg {
            background: #000;
        }

        .product-matrix {
            display: grid;
            grid-template-columns: repeat(3, 40px);
            gap: 2px;
            justify-content: center;
        }

        .cell {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface);
            font-size: 0.75rem;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <div class="container">
        <nav class="nav-header">
            <a href="index.html" class="back-link">‚Üê Back to Hub</a>
            <div class="badge">Activity 03</div>
        </nav>

        <header style="margin-bottom: 2rem;">
            <h1>Matrix Operations</h1>
            <p style="color: var(--text-muted);">From dot products to determinants: exploring the building blocks of
                matrix algebra.</p>
        </header>

        <div class="op-grid">
            <!-- Left Side: Interactive Area -->
            <div class="glass-card">
                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                    <button id="btn-prod" class="tab-btn active" onclick="showSection('products')">Vector
                        Products</button>
                    <button id="btn-det" class="tab-btn" onclick="showSection('determinant')">Area & Det</button>
                </div>

                <div id="section-products" class="interactive-area"
                    style="height: 400px; flex-direction: column; padding: 2rem;">
                    <div style="display: flex; gap: 2rem; align-items: center;">
                        <div>
                            <p class="badge">Vector \(\mathbf{u}\)</p>
                            <input type="number" id="ux" value="1" style="width: 50px;">
                            <input type="number" id="uy" value="2" style="width: 50px;">
                        </div>
                        <div style="font-size: 2rem;">&times;</div>
                        <div>
                            <p class="badge">Vector \(\mathbf{v}\)</p>
                            <input type="number" id="vx" value="3" style="width: 50px;">
                            <input type="number" id="vy" value="1" style="width: 50px;">
                        </div>
                    </div>

                    <div style="margin-top: 2rem; width: 100%;">
                        <h5>Inner Product (Scalar)</h5>
                        <div class="math-block" id="inner-res">\(\mathbf{u}^T \mathbf{v} = 5\)</div>

                        <h5>Outer Product (Matrix)</h5>
                        <div id="outer-res" class="product-matrix"
                            style="margin-top: 1rem; grid-template-columns: repeat(2, 60px);">
                            <!-- Matrix cells generated by JS -->
                        </div>
                    </div>
                </div>

                <div id="section-determinant" class="interactive-area" style="height: 400px; display: none;">
                    <svg viewBox="-80 -80 160 160" id="det-svg">
                        <polygon id="det-poly" fill="rgba(16, 185, 129, 0.3)" stroke="var(--accent)" stroke-width="1" />
                        <line id="det-v1" stroke="var(--primary)" stroke-width="3" />
                        <line id="det-v2" stroke="var(--secondary)" stroke-width="3" />
                    </svg>
                </div>
            </div>

            <!-- Right Side: Discussion & Insights -->
            <div class="glass-card">
                <h3>Key Concept: Numerical Stability</h3>
                <p style="font-size: 0.9rem; color: var(--text-muted); margin: 1rem 0;">Small changes in input can lead
                    to large errors in nearly singular matrices.</p>

                <div class="control-group">
                    <label>Sensitivity Delta (\(\delta\)): <span id="val-delta">0.1</span></label>
                    <input type="range" id="delta-slider" min="0" max="1" step="0.01" value="0.1">
                </div>

                <div class="math-block" style="font-size: 0.8rem;">
                    \( \begin{bmatrix} 1 & 1+\delta \\ 1 & 1 \end{bmatrix} \begin{bmatrix} x \\ y \end{bmatrix} =
                    \begin{bmatrix} 2 \\ 2 \end{bmatrix} \)
                </div>

                <p style="font-size: 0.85rem; margin-top: 1rem;">When vectors are almost parallel (small \(\delta\)),
                    the determinant approaches zero, and the system becomes "ill-conditioned".</p>

                <div id="stability-info" class="badge" style="width: 100%; margin-top: 1rem; text-align: center;">
                    Status: Stable
                </div>
            </div>
        </div>

        <section class="glass-card" style="margin-top: 2rem;">
            <h3>Observations for Groups</h3>
            <ul>
                <li>What is the rank of every outer product matrix you can generate? Why?</li>
                <li>How does the area of the parallelogram relate to the determinant of the matrix formed by those two
                    vectors?</li>
                <li>Try setting \(\delta\) to 0.01. What happens to the solvability of the system?</li>
            </ul>
        </section>
    </div>

    <script>
        const uInputs = [document.getElementById('ux'), document.getElementById('uy')];
        const vInputs = [document.getElementById('vx'), document.getElementById('vy')];
        const innerRes = document.getElementById('inner-res');
        const outerRes = document.getElementById('outer-res');
        const deltaSlider = document.getElementById('delta-slider');
        const valDelta = document.getElementById('val-delta');
        const stabilityInfo = document.getElementById('stability-info');

        function showSection(section) {
            document.getElementById('section-products').style.display = section === 'products' ? 'flex' : 'none';
            document.getElementById('section-determinant').style.display = section === 'determinant' ? 'flex' : 'none';
            document.getElementById('btn-prod').classList.toggle('active', section === 'products');
            document.getElementById('btn-det').classList.toggle('active', section === 'determinant');
        }

        function update() {
            const ux = parseFloat(uInputs[0].value);
            const uy = parseFloat(uInputs[1].value);
            const vx = parseFloat(vInputs[0].value);
            const vy = parseFloat(vInputs[1].value);

            // Inner Product
            const dot = (ux * vx) + (uy * vy);
            innerRes.textContent = `\\mathbf{u}^T \\mathbf{v} = ${dot.toFixed(2)}`;

            // Outer Product
            const m00 = ux * vx; const m01 = ux * vy;
            const m10 = uy * vx; const m11 = uy * vy;
            outerRes.innerHTML = `
                        <div class="cell">${m00.toFixed(1)}</div><div class="cell">${m01.toFixed(1)}</div>
                        <div class="cell">${m10.toFixed(1)}</div><div class="cell">${m11.toFixed(1)}</div>
                    `;

            // Determinant Visualizer
            const s = 20; // scale
            const p = document.getElementById('det-poly');
            p.setAttribute('points', `0,0 ${ux * s},${-uy * s} ${(ux + vx) * s},${-(uy + vy) * s} ${vx * s},${-vy * s}`);

            document.getElementById('det-v1').setAttribute('x2', ux * s);
            document.getElementById('det-v1').setAttribute('y2', -uy * s);
            document.getElementById('det-v2').setAttribute('x2', vx * s);
            document.getElementById('det-v2').setAttribute('y2', -vy * s);

            // Stability
            const delta = parseFloat(deltaSlider.value);
            valDelta.textContent = delta.toFixed(2);
            if (delta < 0.05) {
                stabilityInfo.textContent = "Status: ILL-CONDITIONED";
                stabilityInfo.style.background = "#EF4444";
                stabilityInfo.style.color = "white";
            } else {
                stabilityInfo.textContent = "Status: Stable";
                stabilityInfo.style.background = "var(--surface)";
                stabilityInfo.style.color = "var(--text-muted)";
            }

            if (window.MathJax) MathJax.typesetPromise();
        }

        [...uInputs, ...vInputs, deltaSlider].forEach(el => el.addEventListener('input', update));
        update();
    </script>
</body>

</html>